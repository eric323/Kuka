<!-- **********************************************************************
Name:  KAPContractView.page
======================================================
Purpose:

This page displays contracts
======================================================
History
-------
Date        AUTHOR                      DETAIL
30/08/2016  Wolfram von Reizenstein     INITIAL
02/11/2016  Andreas Meyer               use jQuery to inject link target
07/11/2016  Andreas Meyer               DC-721 and remove jQuery
********************************************************************** -->
<apex:page sidebar="false" showHeader="false" standardController="KeyAccountPlan__c" extensions="KAPContractViewController">
<style>
.pagbuttonlink {
    width: auto;
    border: 1px solid #CCC!important;
    padding: 1px;
    text-align: center;
    text-decoration:none;
}

.pagbuttonlinkActive {
    width: auto;
    border: 1px solid #CCC!important;
    padding: 1px;
    text-align: center;
    background-color: #e0e0e0!important;
}
</style>

<base target="_parent" />
    <apex:form > 
        <apex:outputPanel id="mainPanel"> 
            <apex:outputPanel id="hasnovalues" rendered="{!novalues}">
                {!noContractsAvailable}
            </apex:outputPanel> 
            <apex:outputPanel id="hasvalues" rendered="{!NOT(novalues)}">  
                <apex:outputPanel id="dataPanel">    
                    <apex:pageBlock id="contracts">
                        <apex:pageBlockTable id="contractsTable" var="contracts" value="{!listContractsByPage}">
                            <apex:repeat var="f" value="{!$ObjectType.Contract.FieldSets.KAPFieldDetails}">
                                <apex:column headerValue="{!f.label}" rendered="{!f != 'Name'}">
                                   <apex:outputPanel rendered="{!f == 'Id'}">
                                       <apex:outputLink value="/{!contracts['Id'] }" target="_parent" >{!contracts['Name'] }</apex:outputLink>
                                   </apex:outputPanel>
                                   <apex:outputPanel rendered="{!f != 'Id'}">
                                       <apex:outputField value="{!contracts[f]}" rendered="{!f.Type != 'reference'}" /> 
                                       <!-- <apex:outputField styleClass="openInParent" value="{!contracts[f.fieldPath]}" rendered="{!f.Type == 'reference'}" />   -->
                                        <apex:outputLink value="/{!contracts[f] }" target="_parent" rendered="{!f.Type == 'reference'}">{!contracts[mapReferenceNameFields[f.fieldPath]]}</apex:outputLink>                                                                          
                                   </apex:outputPanel>                  
                                </apex:column>
                            </apex:repeat>
                        </apex:pageBlockTable>
                    </apex:pageBlock>
                </apex:outputPanel>
                <apex:outputPanel rendered="{!AND(IF(paginater.isAll, false, true), IF(paginater.totalPage == 1, false, true))}"> 
                    <apex:outputText rendered="{!paginater.showPrevious}"> 
                        <apex:commandLink action="{!previousPage}" value="Prev" rerender="mainPanel" styleClass="pagbuttonlink" />
                    </apex:outputText> 
                    <apex:repeat value="{!paginater.pageList}" var="pl"> 
                        <apex:outputText rendered="{!!pl.isActive}"> 
                            <apex:commandLink action="{!updatePage}" rerender="mainPanel" styleClass="pagbuttonlink" > {!pl.pageNum} 
                                <apex:param name="selectedPage" value="{!pl.pageNum}" assignTo="{!paginater.pageNum}" /> 
                            </apex:commandLink> 
                        </apex:outputText> 
                        <apex:outputText rendered="{!pl.isActive}" value="{!pl.pageNum}" styleClass="pagbuttonlinkActive" /> 
                                            <!-- andreas.meyer@salesforce.com 29.07.2016: add space -->
                        &nbsp;
                    </apex:repeat> 
                    <apex:outputText rendered="{!paginater.showNext}"> 
                        <apex:commandLink action="{!nextPage}" value="Next" rerender="mainPanel"  styleClass="pagbuttonlink" /> 
                    </apex:outputText> 
                </apex:outputPanel> 
            </apex:outputPanel> 
         </apex:outputPanel> 
    </apex:form> 
</apex:page>